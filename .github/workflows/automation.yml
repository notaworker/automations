name: Energy Automation

on:
  schedule:
    # Kör var 15:e minut
    - cron: "*/15 * * * *"
  workflow_dispatch: {}

jobs:
  run-automation:
    runs-on: ubuntu-latest

    env:
      # Email
      GMAIL_USER: ${{ secrets.GMAIL_USER }}
      GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
      EMAIL_RECIPIENT: ${{ secrets.EMAIL_RECIPIENT }}

      # Growatt – krävs av updateExportLimit.mjs
      GROWATT_USERNAME: ${{ secrets.GROWATT_USERNAME }}
      GROWATT_PASSWORD: ${{ secrets.GROWATT_PASSWORD }}
      DEVICE_SN: ${{ secrets.DEVICE_SN }}
      INVERTER_PASSWORD: ${{ secrets.INVERTER_PASSWORD }}

      # Tibber
      TIBBER_TOKEN: ${{ secrets.TIBBER_TOKEN }}
      TIBBER_HOME_ID: ${{ secrets.TIBBER_HOME_ID }}

      # Script settings
      USER_AGENT: github-actions/1.0
      TIMEOUT_MS: 15000

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Run automation script
        run: node automation.mjs
